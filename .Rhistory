geom_line(color = "darkred", alpha = 0.7) +
geom_smooth(method = "lm") +
labs(
title = paste0("Dispersion Ratio vs. Parameter p"),
subtitle = "Ratio of Observed Mean to Observed Variance using non-vectorized simulation",
x = "Parameter p (0.01 to 0.99)",
y = "Mean / Variance Ratio (Dispersion)"
) +
theme_bw()
# Print the plot
print(dispersion_plot)
# Display the first few results rows
head(simulation_results3)
find_parameters(4.84326, 6.808941)
d <- r_ztbinom_book(n = 10000, p = 0.511342, N = 9.265411)
draws <- as.data.frame(d) |>
rename(draws = d)
draws |>
ggplot(aes(x = draws)) +
geom_histogram(binwidth = 1) +
theme_bw()
mean(draws$draws)
var(draws$draws)
d <- r_ztbinom_book(n = 10000, p = 0.511342, N = 9.265411)
draws <- as.data.frame(d) |>
rename(draws = d)
draws |>
ggplot(aes(x = draws)) +
geom_histogram(binwidth = 1) +
theme_bw()
mean(draws$draws)
var(draws$draws)
# ---------------------------------------------------------
# 3. Diagnostic Test Suite
# ---------------------------------------------------------
# Define a set of target Means and Variances to test
# Note: For Negative Binomial, Variance usually must be > Mean
test_scenarios <- tribble(
~Target_Mean, ~Target_Var,
1.5,          5,
4.8566,       6.693906,
5.0,          8.0,
10.5,         100,
10.0,         11.0,
)
# Function to run a single diagnostic row
run_diagnostic <- function(t_mean, t_var) {
# 1. Solve for N and P
params <- find_parameters(t_mean, t_var)
est_n <- params$Estimated_N
est_p <- params$Estimated_P
# 3. Generate Simulation
# Using the user's r_ztbinom_book function
# We generate a large sample size (n=50,000) to ensure stability of the sim mean/var
sim_values <- r_ztbinom_book(n = 50000, p = est_p, N = est_n)
# 4. Calculate Simulated Metrics
sim_mean <- mean(sim_values)
sim_var  <- var(sim_values)
# 5. Return Row
tibble(
Target_Mean = t_mean,
Target_Var  = t_var,
Estimated_N = est_n,
Estimated_P = est_p,
check_Mean = sim_mean,
check_Var = sim_var,
# Calculate % error between Input Mean and Sim Mean
Mean_Diff_Pct = paste0(round(((sim_mean - t_mean) / t_mean) * 100, 2), "%"),
Var_Diff_Pct = paste0(round(((sim_var - t_var) / t_var) * 100, 2), "%")
)
}
# Execute the tests across all scenarios
results_table <- test_scenarios |>
pmap_dfr(function(Target_Mean, Target_Var) {
run_diagnostic(Target_Mean, Target_Var)
})
# ---------------------------------------------------------
# 4. Output Formatted Table
# ---------------------------------------------------------
results_table
# ---------------------------------------------------------
# 3. Diagnostic Test Suite
# ---------------------------------------------------------
# Define a set of target Means and Variances to test
# Note: For Negative Binomial, Variance usually must be > Mean
test_scenarios <- tribble(
~Target_Mean, ~Target_Var,
1.5,          5,
4.8566,       6.693906,
5.0,          10.0,
10.5,         100,
10.0,         11.0,
)
# Function to run a single diagnostic row
run_diagnostic <- function(t_mean, t_var) {
# 1. Solve for N and P
params <- find_parameters(t_mean, t_var)
est_n <- params$Estimated_N
est_p <- params$Estimated_P
# 3. Generate Simulation
# Using the user's r_ztbinom_book function
# We generate a large sample size (n=50,000) to ensure stability of the sim mean/var
sim_values <- r_ztbinom_book(n = 50000, p = est_p, N = est_n)
# 4. Calculate Simulated Metrics
sim_mean <- mean(sim_values)
sim_var  <- var(sim_values)
# 5. Return Row
tibble(
Target_Mean = t_mean,
Target_Var  = t_var,
Estimated_N = est_n,
Estimated_P = est_p,
check_Mean = sim_mean,
check_Var = sim_var,
# Calculate % error between Input Mean and Sim Mean
Mean_Diff_Pct = paste0(round(((sim_mean - t_mean) / t_mean) * 100, 2), "%"),
Var_Diff_Pct = paste0(round(((sim_var - t_var) / t_var) * 100, 2), "%")
)
}
# Execute the tests across all scenarios
results_table <- test_scenarios |>
pmap_dfr(function(Target_Mean, Target_Var) {
run_diagnostic(Target_Mean, Target_Var)
})
# ---------------------------------------------------------
# 4. Output Formatted Table
# ---------------------------------------------------------
results_table
# ---------------------------------------------------------
# 3. Diagnostic Test Suite
# ---------------------------------------------------------
# Define a set of target Means and Variances to test
# Note: For Negative Binomial, Variance usually must be > Mean
test_scenarios <- tribble(
~Target_Mean, ~Target_Var,
1.5,          5,
4.8566,       6.693906,
5.0,          9.0,
10.5,         100,
10.0,         11.0,
)
# Function to run a single diagnostic row
run_diagnostic <- function(t_mean, t_var) {
# 1. Solve for N and P
params <- find_parameters(t_mean, t_var)
est_n <- params$Estimated_N
est_p <- params$Estimated_P
# 3. Generate Simulation
# Using the user's r_ztbinom_book function
# We generate a large sample size (n=50,000) to ensure stability of the sim mean/var
sim_values <- r_ztbinom_book(n = 50000, p = est_p, N = est_n)
# 4. Calculate Simulated Metrics
sim_mean <- mean(sim_values)
sim_var  <- var(sim_values)
# 5. Return Row
tibble(
Target_Mean = t_mean,
Target_Var  = t_var,
Estimated_N = est_n,
Estimated_P = est_p,
check_Mean = sim_mean,
check_Var = sim_var,
# Calculate % error between Input Mean and Sim Mean
Mean_Diff_Pct = paste0(round(((sim_mean - t_mean) / t_mean) * 100, 2), "%"),
Var_Diff_Pct = paste0(round(((sim_var - t_var) / t_var) * 100, 2), "%")
)
}
# Execute the tests across all scenarios
results_table <- test_scenarios |>
pmap_dfr(function(Target_Mean, Target_Var) {
run_diagnostic(Target_Mean, Target_Var)
})
# ---------------------------------------------------------
# 4. Output Formatted Table
# ---------------------------------------------------------
results_table
# ---------------------------------------------------------
# 3. Diagnostic Test Suite
# ---------------------------------------------------------
# Define a set of target Means and Variances to test
# Note: For Negative Binomial, Variance usually must be > Mean
test_scenarios <- tribble(
~Target_Mean, ~Target_Var,
1.5,          5,
4.8566,       6.693906,
5.0,          9.5,
10.5,         100,
10.0,         11.0,
)
# Function to run a single diagnostic row
run_diagnostic <- function(t_mean, t_var) {
# 1. Solve for N and P
params <- find_parameters(t_mean, t_var)
est_n <- params$Estimated_N
est_p <- params$Estimated_P
# 3. Generate Simulation
# Using the user's r_ztbinom_book function
# We generate a large sample size (n=50,000) to ensure stability of the sim mean/var
sim_values <- r_ztbinom_book(n = 50000, p = est_p, N = est_n)
# 4. Calculate Simulated Metrics
sim_mean <- mean(sim_values)
sim_var  <- var(sim_values)
# 5. Return Row
tibble(
Target_Mean = t_mean,
Target_Var  = t_var,
Estimated_N = est_n,
Estimated_P = est_p,
check_Mean = sim_mean,
check_Var = sim_var,
# Calculate % error between Input Mean and Sim Mean
Mean_Diff_Pct = paste0(round(((sim_mean - t_mean) / t_mean) * 100, 2), "%"),
Var_Diff_Pct = paste0(round(((sim_var - t_var) / t_var) * 100, 2), "%")
)
}
# Execute the tests across all scenarios
results_table <- test_scenarios |>
pmap_dfr(function(Target_Mean, Target_Var) {
run_diagnostic(Target_Mean, Target_Var)
})
# ---------------------------------------------------------
# 4. Output Formatted Table
# ---------------------------------------------------------
results_table
# ---------------------------------------------------------
# 3. Diagnostic Test Suite
# ---------------------------------------------------------
# Define a set of target Means and Variances to test
# Note: For Negative Binomial, Variance usually must be > Mean
test_scenarios <- tribble(
~Target_Mean, ~Target_Var,
1.5,          5,
4.8566,       6.693906,
5.0,          9.2,
10.5,         100,
10.0,         11.0,
)
# Function to run a single diagnostic row
run_diagnostic <- function(t_mean, t_var) {
# 1. Solve for N and P
params <- find_parameters(t_mean, t_var)
est_n <- params$Estimated_N
est_p <- params$Estimated_P
# 3. Generate Simulation
# Using the user's r_ztbinom_book function
# We generate a large sample size (n=50,000) to ensure stability of the sim mean/var
sim_values <- r_ztbinom_book(n = 50000, p = est_p, N = est_n)
# 4. Calculate Simulated Metrics
sim_mean <- mean(sim_values)
sim_var  <- var(sim_values)
# 5. Return Row
tibble(
Target_Mean = t_mean,
Target_Var  = t_var,
Estimated_N = est_n,
Estimated_P = est_p,
check_Mean = sim_mean,
check_Var = sim_var,
# Calculate % error between Input Mean and Sim Mean
Mean_Diff_Pct = paste0(round(((sim_mean - t_mean) / t_mean) * 100, 2), "%"),
Var_Diff_Pct = paste0(round(((sim_var - t_var) / t_var) * 100, 2), "%")
)
}
# Execute the tests across all scenarios
results_table <- test_scenarios |>
pmap_dfr(function(Target_Mean, Target_Var) {
run_diagnostic(Target_Mean, Target_Var)
})
# ---------------------------------------------------------
# 4. Output Formatted Table
# ---------------------------------------------------------
results_table
# ---------------------------------------------------------
# 3. Diagnostic Test Suite
# ---------------------------------------------------------
# Define a set of target Means and Variances to test
# Note: For Negative Binomial, Variance usually must be > Mean
test_scenarios <- tribble(
~Target_Mean, ~Target_Var,
1.5,          5,
4.8566,       6.693906,
5.0,          9.1,
10.5,         100,
10.0,         11.0,
)
# Function to run a single diagnostic row
run_diagnostic <- function(t_mean, t_var) {
# 1. Solve for N and P
params <- find_parameters(t_mean, t_var)
est_n <- params$Estimated_N
est_p <- params$Estimated_P
# 3. Generate Simulation
# Using the user's r_ztbinom_book function
# We generate a large sample size (n=50,000) to ensure stability of the sim mean/var
sim_values <- r_ztbinom_book(n = 50000, p = est_p, N = est_n)
# 4. Calculate Simulated Metrics
sim_mean <- mean(sim_values)
sim_var  <- var(sim_values)
# 5. Return Row
tibble(
Target_Mean = t_mean,
Target_Var  = t_var,
Estimated_N = est_n,
Estimated_P = est_p,
check_Mean = sim_mean,
check_Var = sim_var,
# Calculate % error between Input Mean and Sim Mean
Mean_Diff_Pct = paste0(round(((sim_mean - t_mean) / t_mean) * 100, 2), "%"),
Var_Diff_Pct = paste0(round(((sim_var - t_var) / t_var) * 100, 2), "%")
)
}
# Execute the tests across all scenarios
results_table <- test_scenarios |>
pmap_dfr(function(Target_Mean, Target_Var) {
run_diagnostic(Target_Mean, Target_Var)
})
# ---------------------------------------------------------
# 4. Output Formatted Table
# ---------------------------------------------------------
results_table
# ---------------------------------------------------------
# 3. Diagnostic Test Suite
# ---------------------------------------------------------
# Define a set of target Means and Variances to test
# Note: For Negative Binomial, Variance usually must be > Mean
test_scenarios <- tribble(
~Target_Mean, ~Target_Var,
1.5,          5,
4.8566,       6.693906,
5.0,          9.001,
10.5,         100,
10.0,         11.0,
)
# Function to run a single diagnostic row
run_diagnostic <- function(t_mean, t_var) {
# 1. Solve for N and P
params <- find_parameters(t_mean, t_var)
est_n <- params$Estimated_N
est_p <- params$Estimated_P
# 3. Generate Simulation
# Using the user's r_ztbinom_book function
# We generate a large sample size (n=50,000) to ensure stability of the sim mean/var
sim_values <- r_ztbinom_book(n = 50000, p = est_p, N = est_n)
# 4. Calculate Simulated Metrics
sim_mean <- mean(sim_values)
sim_var  <- var(sim_values)
# 5. Return Row
tibble(
Target_Mean = t_mean,
Target_Var  = t_var,
Estimated_N = est_n,
Estimated_P = est_p,
check_Mean = sim_mean,
check_Var = sim_var,
# Calculate % error between Input Mean and Sim Mean
Mean_Diff_Pct = paste0(round(((sim_mean - t_mean) / t_mean) * 100, 2), "%"),
Var_Diff_Pct = paste0(round(((sim_var - t_var) / t_var) * 100, 2), "%")
)
}
# Execute the tests across all scenarios
results_table <- test_scenarios |>
pmap_dfr(function(Target_Mean, Target_Var) {
run_diagnostic(Target_Mean, Target_Var)
})
# ---------------------------------------------------------
# 4. Output Formatted Table
# ---------------------------------------------------------
results_table
# ---------------------------------------------------------
# 3. Diagnostic Test Suite
# ---------------------------------------------------------
# Define a set of target Means and Variances to test
# Note: For Negative Binomial, Variance usually must be > Mean
test_scenarios <- tribble(
~Target_Mean, ~Target_Var,
1.5,          5,
4.8566,       6.693906,
5.0,          9.01,
10.5,         100,
10.0,         11.0,
)
# Function to run a single diagnostic row
run_diagnostic <- function(t_mean, t_var) {
# 1. Solve for N and P
params <- find_parameters(t_mean, t_var)
est_n <- params$Estimated_N
est_p <- params$Estimated_P
# 3. Generate Simulation
# Using the user's r_ztbinom_book function
# We generate a large sample size (n=50,000) to ensure stability of the sim mean/var
sim_values <- r_ztbinom_book(n = 50000, p = est_p, N = est_n)
# 4. Calculate Simulated Metrics
sim_mean <- mean(sim_values)
sim_var  <- var(sim_values)
# 5. Return Row
tibble(
Target_Mean = t_mean,
Target_Var  = t_var,
Estimated_N = est_n,
Estimated_P = est_p,
check_Mean = sim_mean,
check_Var = sim_var,
# Calculate % error between Input Mean and Sim Mean
Mean_Diff_Pct = paste0(round(((sim_mean - t_mean) / t_mean) * 100, 2), "%"),
Var_Diff_Pct = paste0(round(((sim_var - t_var) / t_var) * 100, 2), "%")
)
}
# Execute the tests across all scenarios
results_table <- test_scenarios |>
pmap_dfr(function(Target_Mean, Target_Var) {
run_diagnostic(Target_Mean, Target_Var)
})
# ---------------------------------------------------------
# 4. Output Formatted Table
# ---------------------------------------------------------
results_table
# ---------------------------------------------------------
# 3. Diagnostic Test Suite
# ---------------------------------------------------------
# Define a set of target Means and Variances to test
# Note: For Negative Binomial, Variance usually must be > Mean
test_scenarios <- tribble(
~Target_Mean, ~Target_Var,
1.5,          5,
4.8566,       6.693906,
5.0,          9.05,
10.5,         100,
10.0,         11.0,
)
# Function to run a single diagnostic row
run_diagnostic <- function(t_mean, t_var) {
# 1. Solve for N and P
params <- find_parameters(t_mean, t_var)
est_n <- params$Estimated_N
est_p <- params$Estimated_P
# 3. Generate Simulation
# Using the user's r_ztbinom_book function
# We generate a large sample size (n=50,000) to ensure stability of the sim mean/var
sim_values <- r_ztbinom_book(n = 50000, p = est_p, N = est_n)
# 4. Calculate Simulated Metrics
sim_mean <- mean(sim_values)
sim_var  <- var(sim_values)
# 5. Return Row
tibble(
Target_Mean = t_mean,
Target_Var  = t_var,
Estimated_N = est_n,
Estimated_P = est_p,
check_Mean = sim_mean,
check_Var = sim_var,
# Calculate % error between Input Mean and Sim Mean
Mean_Diff_Pct = paste0(round(((sim_mean - t_mean) / t_mean) * 100, 2), "%"),
Var_Diff_Pct = paste0(round(((sim_var - t_var) / t_var) * 100, 2), "%")
)
}
# Execute the tests across all scenarios
results_table <- test_scenarios |>
pmap_dfr(function(Target_Mean, Target_Var) {
run_diagnostic(Target_Mean, Target_Var)
})
# ---------------------------------------------------------
# 4. Output Formatted Table
# ---------------------------------------------------------
results_table
# ---------------------------------------------------------
# 3. Diagnostic Test Suite
# ---------------------------------------------------------
# Define a set of target Means and Variances to test
# Note: For Negative Binomial, Variance usually must be > Mean
test_scenarios <- tribble(
~Target_Mean, ~Target_Var,
1.5,          5,
4.8566,       6.693906,
5.0,          9.01,
10.5,         100,
10.0,         11.0,
)
# Function to run a single diagnostic row
run_diagnostic <- function(t_mean, t_var) {
# 1. Solve for N and P
params <- find_parameters(t_mean, t_var)
est_n <- params$Estimated_N
est_p <- params$Estimated_P
# 3. Generate Simulation
# Using the user's r_ztbinom_book function
# We generate a large sample size (n=50,000) to ensure stability of the sim mean/var
sim_values <- r_ztbinom_book(n = 50000, p = est_p, N = est_n)
# 4. Calculate Simulated Metrics
sim_mean <- mean(sim_values)
sim_var  <- var(sim_values)
# 5. Return Row
tibble(
Target_Mean = t_mean,
Target_Var  = t_var,
Estimated_N = est_n,
Estimated_P = est_p,
check_Mean = sim_mean,
check_Var = sim_var,
# Calculate % error between Input Mean and Sim Mean
Mean_Diff_Pct = paste0(round(((sim_mean - t_mean) / t_mean) * 100, 2), "%"),
Var_Diff_Pct = paste0(round(((sim_var - t_var) / t_var) * 100, 2), "%")
)
}
# Execute the tests across all scenarios
results_table <- test_scenarios |>
pmap_dfr(function(Target_Mean, Target_Var) {
run_diagnostic(Target_Mean, Target_Var)
})
# ---------------------------------------------------------
# 4. Output Formatted Table
# ---------------------------------------------------------
results_table
